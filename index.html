<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Formulario de Evaluación</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/2.3.0/css/dataTables.dataTables.min.css">
  <style>
    @media (max-width: 576px) {
      .card {
        border: none !important;
        box-shadow: none !important;
        padding: 1rem !important;
      }
      body {
        background-color: white !important;
      }
      .navbar-brand {
        font-size: 1.1rem;
      }
      .btn {
        padding: 0.375rem 0.75rem;
        font-size: 0.9rem;
      }
      #resultado {
        font-size: 0.9rem;
        max-height: 200px;
        overflow-y: auto;
      }
    }
  </style>
</head>
<body class="bg-light">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="#">Mi Evaluación</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link active" href="#">Inicio</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Evaluación</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Contacto</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Navegación tipo pills -->
  <div class="container py-4">
    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="pills-form-tab" data-bs-toggle="pill" data-bs-target="#pills-form" type="button" role="tab" aria-controls="pills-form" aria-selected="true">Formulario</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="pills-tabla-tab" data-bs-toggle="pill" data-bs-target="#pills-tabla" type="button" role="tab" aria-controls="pills-tabla" aria-selected="false">Resultados</button>
      </li>
    </ul>
    <div class="tab-content" id="pills-tabContent">
      <!-- Formulario -->
      <div class="tab-pane fade show active" id="pills-form" role="tabpanel" aria-labelledby="pills-form-tab" tabindex="0">
        <div class="row justify-content-center">
          <div class="col-12 col-md-8 col-lg-6">
            <div class="card shadow-sm p-3 p-md-4">
              <h4 class="mb-3 mb-md-4 text-center">Formulario de Evaluación</h4>

              <div class="mb-3">
                <label for="nombre" class="form-label">Nombre:</label>
                <input type="text" class="form-control" id="nombre" placeholder="Ingresa tu nombre" required>
              </div>

              <div class="mb-3">
                <label class="form-label">Pregunta 1:</label>
                <select class="form-select respuesta">
                  <option value="">Seleccionar...</option>
                  <option value="25">Respuesta Correcta (25 pts)</option>
                  <option value="13">Respuesta Parcial (13 pts)</option>
                  <option value="0">Respuesta Incorrecta (0 pts)</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Pregunta 2:</label>
                <select class="form-select respuesta">
                  <option value="">Seleccionar...</option>
                  <option value="25">Respuesta Correcta (25 pts)</option>
                  <option value="13">Respuesta Parcial (13 pts)</option>
                  <option value="0">Respuesta Incorrecta (0 pts)</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Pregunta 3:</label>
                <select class="form-select respuesta">
                  <option value="">Seleccionar...</option>
                  <option value="25">Respuesta Correcta (25 pts)</option>
                  <option value="13">Respuesta Parcial (13 pts)</option>
                  <option value="0">Respuesta Incorrecta (0 pts)</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Pregunta 4:</label>
                <select class="form-select respuesta">
                  <option value="">Seleccionar...</option>
                  <option value="25">Respuesta Correcta (25 pts)</option>
                  <option value="13">Respuesta Parcial (13 pts)</option>
                  <option value="0">Respuesta Incorrecta (0 pts)</option>
                </select>
              </div>

              <div class="d-flex flex-column flex-sm-row justify-content-between gap-2">
                <button class="btn btn-secondary flex-grow-1" onclick="reiniciarFormulario()">Reiniciar</button>
                <button class="btn btn-primary flex-grow-1" onclick="generarResultado()">Generar</button>
              </div>

              <div class="mt-4">
                <h3 id="totalResultado" class="text-center fw-bold text-primary mb-3"></h3>
                <div class="d-flex align-items-start">
                  <pre id="resultado" class="mb-0 text-dark fw-bold flex-grow-1 p-2 bg-light rounded border" style="min-height: 100px;"></pre>
                  <button class="btn btn-outline-secondary ms-2" title="Copiar" onclick="copiarResultado()">
                    <i class="bi bi-clipboard"></i>
                  </button>
                </div>
                <div id="mensajeCopiado" class="text-success mt-2 text-center d-none">¡Texto copiado al portapapeles!</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tabla Resultados -->
      <div class="tab-pane fade" id="pills-tabla" role="tabpanel" aria-labelledby="pills-tabla-tab" tabindex="0">
        <div class="row mt-3">
          <div class="col-12">
            <h4 class="text-center mb-3">Datos Registrados</h4>
            <h4 class="text-center mb-3">Los datos son temporales y se eliminan</h4>
            <br/>
            <br/>
            <br/>
            <div class="d-flex justify-content-center gap-2 mb-3">
              <button class="btn btn-success" onclick="exportarCSV()">
                <i class="bi bi-file-earmark-spreadsheet"></i> Exportar CSV
              </button>
              <button class="btn btn-danger" onclick="eliminarDatos()">
                <i class="bi bi-trash"></i> Eliminar Datos
              </button>
            </div>
            <table id="tablaEjemplo" class="table table-striped test-center" style="width:100%">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Pregunta 1</th>
                  <th>Pregunta 2</th>
                  <th>Pregunta 3</th>
                  <th>Pregunta 4</th>
                  <th>Total</th>
                  <th>Opciones</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/2.3.0/js/dataTables.min.js"></script>
  <script>
    let tabla;

    function generarResultado() {
  const nombre = document.getElementById('nombre').value.trim();
  const respuestas = document.querySelectorAll('.respuesta');
  let total = 0;
  let mensaje = '';
  const fila = [nombre];

  const puntosArray = [];

  for (let i = 0; i < respuestas.length; i++) {
    const valor = respuestas[i].value;
    if (valor === "") {
      alert(`Selecciona un valor para la pregunta ${i + 1}`);
      return;
    }
    const puntos = parseInt(valor);
    const textoRespuesta = respuestas[i].options[respuestas[i].selectedIndex].text;

    total += puntos;
    mensaje += `Pregunta ${i + 1}: ${textoRespuesta}\n`;
    fila.push(puntos);
    puntosArray.push({ texto: textoRespuesta, valor: puntos });
  }

  const textoFinal = `Hola ${nombre}:\n${mensaje}`;

  document.getElementById('totalResultado').innerText = `Total: ${total} puntos`;
  document.getElementById('resultado').innerText = textoFinal;

  // Copiar al portapapeles automáticamente
  navigator.clipboard.writeText(textoFinal)
    .then(() => {
      const mensajeCopiado = document.getElementById('mensajeCopiado');
      mensajeCopiado.classList.remove('d-none');
      mensajeCopiado.classList.add('text-success');
      setTimeout(() => mensajeCopiado.classList.add('d-none'), 2000);
    })
    .catch(err => {
      alert("Error al copiar automáticamente: " + err);
    });

  const boton = `<button class='btn btn-outline-secondary btn-sm' onclick='copiarFilaTexto("${nombre}", ${JSON.stringify(puntosArray)})'><i class="bi bi-clipboard"></i></button>`;
  const filaFinal = [...fila, total, boton];
  tabla.row.add(filaFinal).draw();

  guardarLocalStorage();
}


    function copiarFilaTexto(nombre, respuestas) {
      const mensaje = respuestas.map((r, i) => `Pregunta ${i + 1}: ${r.texto} (${r.valor} pts)`).join("\n");
      const texto = `Hola ${nombre}:\n${mensaje}`;
      navigator.clipboard.writeText(texto).then(() => alert("Resultado copiado al portapapeles."));
    }

    function reiniciarFormulario() {
      document.getElementById('nombre').value = '';
      document.querySelectorAll('.respuesta').forEach(select => select.value = '');
      document.getElementById('resultado').innerText = '';
      document.getElementById('totalResultado').innerText = '';
      document.getElementById('mensajeCopiado').classList.add('d-none');
    }

    function copiarResultado() {
      const texto = document.getElementById('resultado').innerText;
      if (texto.trim() === "") {
        alert("No hay nada que copiar.");
        return;
      }

      navigator.clipboard.writeText(texto.trim())
        .then(() => {
          const mensaje = document.getElementById('mensajeCopiado');
          mensaje.classList.remove('d-none');
          setTimeout(() => mensaje.classList.add('d-none'), 2000);
        })
        .catch(err => {
          alert("Error al copiar: " + err);
        });
    }

    function guardarLocalStorage() {
      const datos = tabla.rows().data().toArray();
      localStorage.setItem('evaluaciones', JSON.stringify(datos));
    }

    function cargarLocalStorage() {
      const datosGuardados = JSON.parse(localStorage.getItem('evaluaciones')) || [];
      datosGuardados.forEach(fila => {
        tabla.row.add(fila).draw();
      });
    }

    function exportarCSV() {
      const datos = tabla.rows().data().toArray();
      if (datos.length === 0) {
        alert("No hay datos para exportar.");
        return;
      }

      let csv = "Nombre,Pregunta 1,Pregunta 2,Pregunta 3,Pregunta 4,Total\n";
      datos.forEach(fila => {
        csv += fila.slice(0, 6).join(",") + "\n";
      });

      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "resultados.csv";
      link.click();
    }

    function eliminarDatos() {
      if (confirm("¿Estás seguro de que deseas eliminar todos los datos?")) {
        localStorage.removeItem('evaluaciones');
        tabla.clear().draw();
      }
    }

    $(document).ready(function () {
      tabla = $('#tablaEjemplo').DataTable();
      cargarLocalStorage();
    });
  </script>
</body>
</html>


